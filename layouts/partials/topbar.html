<header class="topbar">
    <div class="topbar__inner">
        <a class="topbar__brand" href="{{ .Site.BaseURL | relLangURL }}">{{ .Site.Title }}</a>

        <nav class="topbar__menu" aria-label="Primary">
            {{ $currentPage := . }}
            {{ range $.Site.Menus.main }}
                {{ $menuURL := .URL }}
                {{ $menuName := .Name }}
                {{ $active := or (eq $currentPage.RelPermalink $menuURL) (or ($currentPage.HasMenuCurrent "main" .) ($currentPage.IsMenuCurrent "main" .)) }}

                {{ if eq $menuURL "/tags/" }}
                    {{ if gt (len $.Site.Taxonomies.tags) 0 }}
                        <details class="topbar__dropdown">
                            <summary class="topbar__link topbar__dropdown-toggle {{ if $active }}is-active{{ end }}">
                                {{- $menuName -}}
                                <span class="topbar__dropdown-caret" aria-hidden="true">▾</span>
                            </summary>
                            <div class="topbar__dropdown-menu">
                                <a class="topbar__dropdown-item" href="{{ $menuURL }}">全部标签</a>
                                {{ range $.Site.Taxonomies.tags.Alphabetical }}
                                    <a class="topbar__dropdown-item" href="{{ .Page.RelPermalink }}">{{ .Page.LinkTitle }}</a>
                                {{ end }}
                            </div>
                        </details>
                    {{ else }}
                        <a class="topbar__link {{ if $active }}is-active{{ end }}"
                           href="{{ $menuURL }}"
                           {{ if eq .Params.newTab true }}target="_blank" rel="noopener"{{ end }}>
                            {{- $menuName -}}
                        </a>
                    {{ end }}
                {{ else if eq $menuURL "/categories/" }}
                    {{ if gt (len $.Site.Taxonomies.categories) 0 }}
                        <details class="topbar__dropdown">
                            <summary class="topbar__link topbar__dropdown-toggle {{ if $active }}is-active{{ end }}">
                                {{- $menuName -}}
                                <span class="topbar__dropdown-caret" aria-hidden="true">▾</span>
                            </summary>
                            <div class="topbar__dropdown-menu">
                                <a class="topbar__dropdown-item" href="{{ $menuURL }}">全部分类</a>
                                {{ range $.Site.Taxonomies.categories.Alphabetical }}
                                    <a class="topbar__dropdown-item" href="{{ .Page.RelPermalink }}">{{ .Page.LinkTitle }}</a>
                                {{ end }}
                            </div>
                        </details>
                    {{ else }}
                        <a class="topbar__link {{ if $active }}is-active{{ end }}"
                           href="{{ $menuURL }}"
                           {{ if eq .Params.newTab true }}target="_blank" rel="noopener"{{ end }}>
                            {{- $menuName -}}
                        </a>
                    {{ end }}
                {{ else }}
                    <a class="topbar__link {{ if $active }}is-active{{ end }}"
                       href="{{ $menuURL }}"
                       {{ if eq .Params.newTab true }}target="_blank" rel="noopener"{{ end }}>
                        {{- $menuName -}}
                    </a>
                {{ end }}
            {{ end }}
        </nav>

        <div class="topbar__actions">
            {{ if (default false .Site.Params.colorScheme.toggle) }}
                <button id="dark-mode-toggle" class="topbar__toggle" type="button" aria-label="{{ T "darkMode" }}">
                    {{ partial "helper/icon" "toggle-left" }}
                    {{ partial "helper/icon" "toggle-right" }}
                    <span>{{ T "darkMode" }}</span>
                </button>
            {{ end }}

            {{- with .Site.Menus.social -}}
                <div class="topbar__social" aria-label="Social links">
                    {{ range . }}
                        <a href="{{ .URL }}"
                           {{ if eq (default true .Params.newTab) true }}target="_blank" rel="me noopener"{{ else }}rel="me"{{ end }}
                           title="{{ .Name }}">
                            {{ $icon := default "link" .Params.Icon }}
                            {{ with $icon }}
                                {{ partial "helper/icon" . }}
                            {{ end }}
                            <span class="sr-only">{{ .Name }}</span>
                        </a>
                    {{ end }}
                </div>
            {{- end -}}
        </div>
    </div>
    <script>
        (function() {
            var dropdowns = document.querySelectorAll('.topbar__dropdown');
            dropdowns.forEach(function(dropdown) {
                dropdown.addEventListener('mouseleave', function() {
                    dropdown.removeAttribute('open');
                });
            });
        })();
    </script>
</header>
